# MySql 调优
从三个层次了解mysql
1. Client
2. Server： 连接器  
   ->分析器（对sql语句进行语法分析，构成一个AST,抽象语法树）  
   ->优化器（两种优化方式，RBO 基于规则的优化/CBO 基于成本的优化）
   ->执行器（sql语句实际执行的组件）
   mysql8.0之前存在缓存这一层，但是由于命中率不高在8.0版本移除了
3. 存储引擎
## 性能监控
- 使用 `show profile`查询剖析工具，可以指定具体的type
见官网文档[mysql性能](https://dev.mysql.com/doc/refman/8.0/en/performance-schema.html)
- 使用`performance_schema`  


## 说一下数据库索引原理，底层索引数据结构，叶子节点存储什么，索引失效的情况
聊数据库的话主要是从两个角度上来回答
1. IO角度：
   1. 尽量减少数据请求，一个是指数据请求的次数，一个是指请求数据的数量。
   2. 分块读取： 每次读页的整数倍
   3. 局部性原理：空间局部性
   
2. 数据结构： 为什么使用B+树，二叉树，AVL树，红黑树都是二叉树，数据量多会引起树的深度增加。
   B树与B+树区别是 B树的节点中既有key，又有数据，且B树的key是不重复的。
   比如说我插入了10个记录，那么就是生成了10个数据节点（B树会根据树的度来生成节点）。
   但是，B+树上，所有数据都是存储在叶子节点的，非叶子节点上只存储key
   
### MMM MHA MGR

### 水平分库 水平分表 垂直分库 垂直分表
就一个表而言，水平分是指一条记录不拆分，只不过是所有记录进行分片，按照范围。
比如说每个月的数据放到一个片里面。
垂直分是指将记录拆开，拆成更小的业务单位。或者说可以将常用的列抽出来形成一张新表，
而不常用的列可以作为另一张表。需要全查的时候做联查就行。

在进行分库分表的时候尽量遵循以下几个原则：
1. 能不切分尽量不要切分，除非数据量很大的时候（千万级别）或者说表的列很多，当百万级别的数据就占用了很大空间的时候。
2. 如果要切分一定要选好合适的切分规则，提前规划好
3. 数据切分尽量通过数据冗余或者表分组来降低跨库join的可能性
4. 由于数据库中间件对数据join的实现难以把握，且实现高性能难度极大，业务读取尽量少使用多表join

### 主从复制 读写分离
主从复制是读写分离和分库分表的前提